syntax = "proto3";

package core;

import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";

message PingReply {
  string message = 1;
}

message AuthRequest {
  string username = 1;
  string email = 2;
  string password = 3;
  string role = 4;
  string phoneNumber = 5;
  string adminKey = 6;
}

message LoginRequest {
  string email = 1;
  string username = 2;
  string phoneNumber = 3;
  string password = 4;
}

message AuthResponse {
  string accessToken = 1;
  PublicUser user = 2;
}

message PublicUser {
  string id = 1;
  string email = 2;
  string username = 3;
  string role = 4;
}

message ThirdPartyRequest {
  string username = 1;
  string email = 2;
  string phoneNumber = 3;
}

message User {
  string id = 1;
  string username = 2;
  string email = 3;
  string phoneNumber = 4;
  string firstName = 5;
  string lastName = 6;
  string password = 7;
  string role = 8;
  string createdAt = 9;
  string updatedAt = 10;
  string lastLogin = 11;
  bool isActive = 12;
  bool isEmailVerified = 13;
  bool isTwoFactorEnabled = 14;
  string twoFactorSecret = 15;
  string resetToken = 16;
  string profilePicture = 17;
  string resetTokenExpiry = 18;
  string lockExpiry = 19;
  string createdBy = 20;
  string updatedBy = 21;
  string deletedAt = 22;
  string deletedBy = 23;
  google.protobuf.Struct metadata = 24;
  string sessionId = 25;
  google.protobuf.Struct deviceInfo = 26;
  string ipAddress = 27;
  string userAgent = 28;
  repeated string twoFactorBackupCodes = 29;
  string passwordResetRequestedAt = 30;
  string emailVerificationToken = 31;
  string emailVerificationTokenExpiry = 32;
  string lastFailedLogin = 33;
  int32 failedLoginAttempts = 34;
  string lastPasswordReset = 35;
  string passwordResetToken = 36;
  string passwordResetTokenExpiry = 37;
  string accountStatus = 38;
  repeated google.protobuf.Struct securityQuestions = 39;
  repeated google.protobuf.Struct securityAnswers = 40;
  string lastSecurityQuestionChange = 41;
  string lastSecurityAnswerChange = 42;
  bool passwordChangeRequired = 43;
  string passwordChangeDeadline = 44;
  string accountRecoveryEmail = 45;
  string accountRecoveryPhone = 46;
  string accountRecoveryToken = 47;
  string accountRecoveryTokenExpiry = 48;
  string accountRecoveryRequestedAt = 49;
  string accountRecoveryStatus = 50;
  string accountRecoveryMethod = 51;
  bool accountRecoveryVerified = 52;
  string accountRecoveryVerificationToken = 53;
  string accountRecoveryVerificationTokenExpiry = 54;
  string accountRecoveryVerificationRequestedAt = 55;
}

message UsersList {
  repeated User items = 1;
}

message MeRequest {
  string userId = 1;
}

message UpdateUserRequest {
  string id = 1;
  User user = 2;
}

message IdRequest {
  string id = 1;
}

message Membership {
  string id = 1;
  string userId = 2;
  string subscriptionId = 3;
  string startDate = 4;
  string endDate = 5;
  string paymentReference = 6;
  bool isActive = 7;
}

message MembershipList {
  repeated Membership items = 1;
}

message MembershipCreateRequest {
  string userId = 1;
  string subscriptionId = 2;
  string paymentReference = 3;
  bool isActive = 4;
}

message MembershipUpdateRequest {
  string id = 1;
  string userId = 2;
  string subscriptionId = 3;
  string paymentReference = 4;
  bool isActive = 5;
}

message MembershipByUserRequest {
  string userId = 1;
}

message MembershipBySubscriptionRequest {
  string subscriptionId = 1;
}

message GenericResponse {
  bool success = 1;
  string message = 2;
}

message Subscription {
  string id = 1;
  string name = 2;
  string description = 3;
  int32 price = 4;
  string currency = 5;
  int32 durationDays = 6;
  repeated string features = 7;
  bool mostPopular = 8;
}

message SubscriptionList {
  repeated Subscription items = 1;
}

message SubscriptionCreateRequest {
  string name = 1;
  string description = 2;
  int32 price = 3;
  string currency = 4;
  int32 durationDays = 5;
  repeated string features = 6;
  bool mostPopular = 7;
}

message SubscriptionUpdateRequest {
  string id = 1;
  string name = 2;
  string description = 3;
  int32 price = 4;
  string currency = 5;
  int32 durationDays = 6;
  repeated string features = 7;
  bool mostPopular = 8;
}

service AuthenticationService {
  rpc Ping(google.protobuf.Empty) returns (PingReply);
  rpc PingDatabase(google.protobuf.Empty) returns (PingReply);
  rpc CreateUser(AuthRequest) returns (AuthResponse);
  rpc CreateAdminUser(AuthRequest) returns (AuthResponse);
  rpc LoginUser(LoginRequest) returns (AuthResponse);
  rpc ValidateThirdParty(ThirdPartyRequest) returns (AuthResponse);
  rpc Me(MeRequest) returns (User);
}

service UsersService {
  rpc PingMe(google.protobuf.Empty) returns (PingReply);
  rpc Me(MeRequest) returns (User);
  rpc FindAll(google.protobuf.Empty) returns (UsersList);
  rpc FindOne(IdRequest) returns (User);
  rpc UpdateUser(UpdateUserRequest) returns (User);
  rpc RemoveUser(IdRequest) returns (User);
  rpc RemoveAllUsers(google.protobuf.Empty) returns (GenericResponse);
}

service MembershipsService {
  rpc Ping(google.protobuf.Empty) returns (PingReply);
  rpc Create(MembershipCreateRequest) returns (Membership);
  rpc FindAll(google.protobuf.Empty) returns (MembershipList);
  rpc FindOne(IdRequest) returns (Membership);
  rpc FindByUser(MembershipByUserRequest) returns (MembershipList);
  rpc FindBySubscription(MembershipBySubscriptionRequest) returns (MembershipList);
  rpc FindActiveByUser(MembershipByUserRequest) returns (Membership);
  rpc Update(MembershipUpdateRequest) returns (Membership);
  rpc Remove(IdRequest) returns (GenericResponse);
  rpc DeactivateExpired(google.protobuf.Empty) returns (GenericResponse);
}

service SubscriptionsService {
  rpc Ping(google.protobuf.Empty) returns (PingReply);
  rpc Create(SubscriptionCreateRequest) returns (Subscription);
  rpc FindAll(google.protobuf.Empty) returns (SubscriptionList);
  rpc FindOne(IdRequest) returns (Subscription);
  rpc Update(SubscriptionUpdateRequest) returns (GenericResponse);
  rpc Remove(IdRequest) returns (GenericResponse);
}
